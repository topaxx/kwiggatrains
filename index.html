<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèãÔ∏è‚Äç‚ôÇÔ∏è KwiggaTrains „Ç∑</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app">
        <!-- Global Header -->
        <header>
            <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è &nbsp;  KwiggaTrains &nbsp;&nbsp; „Ç∑</h1>
        </header>
        
        <!-- Main Screen - Train List -->
        <div id="main-screen" class="screen active">
            <div id="trains-loading" class="trains-loading" style="display: none;">
                <i class="fa-solid fa-spinner fa-spin"></i>
                <p>Loading trains...</p>
            </div>
            <div id="trains-list" class="trains-container">
                <!-- Trains will be added here dynamically -->
            </div>
        </div>

        <!-- Train Builder Screen -->
        <div id="train-builder" class="screen">
            <div class="screen-header">
                <button id="back-from-builder" class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h1 id="train-builder-title">Add Train</h1>
            </div>
            
            <!-- Step 1: Train name -->
            <div id="name-step" class="builder-step active">
                <div class="step-content">
                    <input type="text" id="train-name-input" placeholder="Give your Choo Choo a name..." maxlength="30">
                    <div class="step-buttons">
                        <button id="cancel-train" class="cancel-button">Cancel</button>
                        <button id="next-to-poses" class="next-button" disabled>Next</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Select poses -->
            <div id="poses-step" class="builder-step">
                <div class="step-content">
                    
                    <!-- Train poses list -->
                    <div class="train-poses-section">
                        <div class="train-poses-header">
                        </div>
                        <div id="train-poses-list" class="train-poses-list">
                            <p class="empty-message">Empty Train</p>
                        </div>
                    </div>

                    <!-- Collapsible poses grid -->
                    <div class="poses-selection-section">
                        <div class="poses-selection-header" id="poses-selection-header">
                            <h4>Yoga Poses</h4>
                            <button id="toggle-poses-grid" class="toggle-button rotated">
                                <span id="toggle-icon">‚ñº</span>
                            </button>
                        </div>
                        <div id="poses-grid-container" class="poses-grid-container expanded">
                            <div id="poses-grid" class="poses-grid">
                                <!-- Yoga poses worden hier dynamisch toegevoegd -->
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible activities grid -->
                    <div class="activities-selection-section">
                        <div class="activities-selection-header" id="activities-selection-header">
                            <h4>Activities</h4>
                            <button id="toggle-activities-grid" class="toggle-button">
                                <span id="toggle-activities-icon">‚ñº</span>
                            </button>
                        </div>
                        <div id="activities-grid-container" class="activities-grid-container">
                            <div id="activities-grid" class="activities-grid">
                                <!-- Activities worden hier dynamisch toegevoegd -->
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible exercises grid -->
                    <div class="exercises-selection-section">
                        <div class="exercises-selection-header" id="exercises-selection-header">
                            <h4>Exercises</h4>
                            <button id="toggle-exercises-grid" class="toggle-button rotated">
                                <span id="toggle-exercises-icon">‚ñº</span>
                            </button>
                        </div>
                        <div id="exercises-grid-container" class="exercises-grid-container expanded">
                            <div id="exercises-grid" class="exercises-grid">
                                <!-- Exercises worden hier dynamisch toegevoegd -->
                            </div>
                        </div>
                    </div>

                    <div class="step-buttons">
                        <button id="back-to-name" class="back-step-button">Back</button>
                        <button id="save-train-btn" class="save-button" disabled>Save Train</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time selection popup -->
        <div id="time-selection-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-pose-name">Select time</h3>
                    <button id="close-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="time-options">
                        <div class="time-option" data-time="30">30s</div>
                        <div class="time-option" data-time="60">1m</div>
                        <div class="time-option" data-time="120">2m</div>
                        <div class="time-option" data-time="180">3m</div>
                        <div class="time-option" data-time="300">5m</div>
                        <div class="time-option" data-time="600">10m</div>
                        <div class="time-option" data-time="900">15m</div>
                        <div class="time-option" data-time="1200">20m</div>
                        <div class="time-option" data-time="1800">30m</div>
                        <div class="time-option" data-time="2700">45m</div>
                        <div class="time-option" data-time="3600">1h</div>
                        <div class="time-option" data-time="4500">1h 15m</div>
                        <div class="time-option" data-time="5400">1h 30m</div>
                        <div class="time-option" data-time="6300">1h 45m</div>
                        <div class="time-option" data-time="7200">2h</div>
                    </div>
                    
                    <!-- Repetitions section for exercises -->
                    <div id="repetitions-section" class="repetitions-section" style="display: none;">
                        <h3>Or select repetitions</h3>
                        <div class="repetitions-options">
                            <div class="repetition-option" data-reps="5">5</div>
                            <div class="repetition-option" data-reps="10">10</div>
                            <div class="repetition-option" data-reps="15">15</div>
                            <div class="repetition-option" data-reps="20">20</div>
                            <div class="repetition-option" data-reps="25">25</div>
                            <div class="repetition-option" data-reps="30">30</div>
                            <div class="repetition-option" data-reps="40">40</div>
                            <div class="repetition-option" data-reps="50">50</div>
                            <div class="repetition-option" data-reps="100">100</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Error Modal -->
        <div id="delete-error-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Error</h3>
                    <button id="close-delete-error-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p id="delete-error-text">An error occurred while deleting the train. Please try again.</p>
                    <div class="modal-buttons">
                        <button id="ok-delete-error" class="ok-button">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete confirmation popup -->
        <div id="delete-confirmation-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Retire Train</h3>
                    <button id="close-delete-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p id="delete-confirmation-text">Are you sure you want to delete this train?</p>
                    <div class="modal-buttons">
                        <button id="cancel-delete" class="cancel-button">Cancel</button>
                        <button id="confirm-delete" class="delete-button">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Train saved popup -->
        <div id="save-completion-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üöÇ Choo Choo Saved</h3>
                </div>
                <div class="modal-body">
                    <div class="modal-buttons">
                        <button id="close-save-completion" class="next-button">Back</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Train completed popup -->
        <div id="completion-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üöÇ Choo Choo üöÇ</h3>
                </div>
                <div class="modal-body">
                    <div class="modal-buttons">
                        <button id="close-completion" class="next-button">Back</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Scherm -->
        <div id="history-screen" class="screen">
            <div class="screen-header">
                <button id="back-from-history" class="back-button"><i class="fas fa-arrow-left"></i></button>
            </div>
            
            <div class="history-content">
                <!-- Data Source Toggle -->
                <div class="history-source-toggle">
                    <button id="toggle-database" class="source-toggle-btn active" data-source="database">
                        <i class="fas fa-cloud"></i>
                        <span>Cloud</span>
                    </button>
                    <button id="toggle-local" class="source-toggle-btn" data-source="local">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Local</span>
                    </button>
                </div>

                <div id="history-loading" class="history-loading" style="display: none;">
                    <i class="fa-solid fa-spinner fa-spin"></i>
                    <p>Loading cloud data...</p>
                </div>

                <div id="history-stats" class="history-stats">
                    <!-- Stats will be added here dynamically -->
                </div>

                <h1>Wall of Trains</h1>
                
                <div id="history-list" class="history-list">
                    <!-- History entries will be added here dynamically -->
                </div>
                
                <div class="history-actions">
                    <button id="add-train-history-btn" class="add-train-history-button">
                        <i class="fas fa-plus"></i> Add Train to History
                    </button>
                    <button id="export-history-btn" class="export-history-button"><i class="fas fa-upload"></i> Export History</button>
                    <button id="import-history-btn" class="import-history-button"><i class="fas fa-download"></i> Import History</button>
                    <button id="clear-history-btn" class="clear-history-button"><i class="fas fa-trash"></i> Clear History</button>
                </div>
            </div>
        </div>

        <!-- Clear History Confirmation Modal -->
        <div id="clear-history-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Clear History</h3>
                    <button id="close-clear-history-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p id="clear-history-text">Are you sure you want to clear all history? This cannot be undone.</p>
                    <div class="modal-buttons">
                        <button id="cancel-clear-history" class="cancel-button">Cancel</button>
                        <button id="confirm-clear-history" class="delete-button">Clear History</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import History Modal -->
        <div id="import-history-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Import History</h3>
                    <button id="close-import-history-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p>Select a JSON file to import history data.</p>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                    <div class="file-input-area" id="file-input-area">
                        <div class="file-input-content">
                            <div class="file-input-icon">üìÅ</div>
                            <div class="file-input-text">Click to select JSON file</div>
                            <div class="file-input-hint">or drag and drop</div>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button id="cancel-import-history" class="cancel-button">Cancel</button>
                        <button id="confirm-import-history" class="next-button" disabled>Import History</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Error Modal -->
        <div id="import-error-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Import Error</h3>
                    <button id="close-import-error-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p id="import-error-text">An error occurred while importing the file. Please try again.</p>
                    <div class="modal-buttons">
                        <button id="ok-import-error" class="ok-button">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Success Modal -->
        <div id="import-success-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚úÖ Import Successful</h3>
                    <button id="close-import-success-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <p id="import-success-text">History imported successfully!</p>
                    <div class="modal-buttons">
                        <button id="close-import-success" class="next-button">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Train to History Modal -->
        <div id="add-train-history-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Train to History</h3>
                    <button id="close-add-train-history-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="select-train-dropdown">Select Train:</label>
                        <select id="select-train-dropdown" class="train-select-dropdown">
                            <option value="">-- Select a train --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completion-date-input">Completion Date:</label>
                        <input type="datetime-local" id="completion-date-input" class="date-input">
                    </div>
                    <div class="modal-buttons">
                        <button id="cancel-add-train-history" class="cancel-button">Cancel</button>
                        <button id="confirm-add-train-history" class="next-button" disabled>Add to History</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logout Success Modal -->
        <div id="logout-success-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üëã Logged Out Successfully</h3>
                </div>
                <div class="modal-body">
                    <p id="logout-success-text">You have been successfully logged out.</p>
                    <div class="modal-buttons">
                        <button id="close-logout-success" class="next-button">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rename Train Modal -->
        <div id="rename-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Rename Train</h3>
                    <button id="close-rename-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <input type="text" id="rename-input" placeholder="New train name..." maxlength="30">
                    <div class="modal-buttons">
                        <button id="cancel-rename" class="cancel-button">Cancel</button>
                        <button id="confirm-rename" class="next-button">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Train Execution Screen -->
        <div id="train-execution" class="screen">
            <button id="back-from-execution" class="back-button"><i class="fas fa-arrow-left"></i></button>
            
            <div class="execution-content">
                <div class="pose-display">
                    <h2 id="current-pose-name">Pose Name</h2>
                    <img id="current-pose-image" src="" alt="Current pose">
                </div>
                
                <div class="timer-section">
                    <div class="timer-circle">
                        <svg viewBox="0 0 150 150">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle class="progress-ring" cx="75" cy="75" r="71"></circle>
                            <circle class="progress-ring-fill" cx="75" cy="75" r="71" stroke-dasharray="446" stroke-dashoffset="446"></circle>
                        </svg>
                        <div class="timer-text">
                            <span id="timer-display">00:00</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                </div>

                <div class="execution-controls">
                    <button id="previous-pose-btn" class="control-button">‚óÄ</button>
                    <button id="pause-resume-btn" class="control-button">‚è∏</button>
                    <button id="next-pose-btn" class="control-button">‚ñ∂</button>
                </div>

                <div class="pose-counter">
                    <span id="pose-counter">1 / 5</span>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <div class="screen-header">
                <button id="back-from-settings" class="back-button"><i class="fas fa-arrow-left"></i></button>
            </div>
            
            <div class="settings-content">
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3>Account</h3>
                        <button id="settings-logout-btn" class="settings-logout-button" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                    <div class="settings-item">
                        <div id="settings-login-content" class="login-options">
                            <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">
                                Login to save your trains in the cloud
                            </p>
                            <button id="settings-twitter-login-btn" class="twitter-login-button">
                                <i class="fas fa-sign-in-alt"></i>
                                Login
                            </button>
                            <div id="settings-login-loading" class="settings-login-loading" style="display: none;">
                                <i class="fa-solid fa-spinner fa-spin"></i>
                                <p>Logging in...</p>
                            </div>
                        </div>
                        <div id="settings-user-content" class="auth-content" style="display: none;">
                            <div class="user-info">
                                <div class="user-avatar">
                                    <img id="settings-user-avatar-img" src="" alt="User Avatar">
                                </div>
                                <div class="user-details">
                                    <h4 id="settings-user-name">User Name</h4>
                                    <p id="settings-user-email">user@example.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User ID Display Modal -->
        <div id="userid-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîó User Profile Connected</h3>
                    <button id="close-userid-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="userid-info">
                        <div class="userid-avatar">
                            <img id="userid-avatar-img" src="" alt="User Avatar">
                        </div>
                        <div class="userid-details">
                            <h4 id="userid-name">User Name</h4>
                            <p id="userid-email">user@example.com</p>
                            <div class="userid-id">
                                <strong>User ID:</strong>
                                <code id="userid-display">Loading...</code>
                            </div>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button id="close-userid" class="next-button">Got it!</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Authentication Modal -->
        <div id="user-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="user-modal-title">Login</h3>
                    <button id="close-user-modal" class="close-button">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="login-content" class="auth-content">
                        <div class="login-options">
                            <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">
                                Login to save your trains in the cloud
                            </p>
                            <button id="twitter-login-btn" class="twitter-login-button">
                                <i class="fas fa-sign-in-alt"></i>
                                Login
                            </button>
                        </div>
                    </div>
                    <div id="user-content" class="auth-content" style="display: none;">
                        <div class="user-info">
                            <div class="user-avatar">
                                <img id="user-avatar-img" src="" alt="User Avatar">
                            </div>
                            <div class="user-details">
                                <h4 id="user-name">User Name</h4>
                                <p id="user-email">user@example.com</p>
                            </div>
                        </div>
                        <div class="user-actions">
                            <button id="logout-btn" class="logout-button">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Footer -->
        <footer class="main-footer">
            <button id="add-train-btn" class="add-button">
                „Ç∑ Add Train
            </button>
            <button id="show-history-btn" class="history-button">
                <i class="fas fa-chart-line"></i> History
            </button>
            <button id="settings-btn" class="settings-button">
                <i class="fas fa-cog"></i>
            </button>
        </footer>
    </div>

    <!-- Modular JavaScript files -->
    <script src="js/data.js?v=2.0"></script>
    <script src="js/state.js?v=2.0"></script>
    <script src="js/dom.js?v=2.0"></script>
    <script src="js/audio.js?v=2.0"></script>
    <script src="js/navigation.js?v=2.0"></script>
    <script src="js/train-builder.js?v=2.0"></script>
    <script src="js/train-execution.js?v=2.0"></script>
    <script src="js/history.js?v=2.0"></script>
    <script src="js/auth.js?v=2.0"></script>
    <script src="js/database.js?v=2.0"></script>
    <script src="js/main.js?v=2.0"></script>
</body>
</html>
